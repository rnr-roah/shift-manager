<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
            color: #2c2c2c;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(83, 83, 83, 0.295);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
            min-height: 95vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f3f4;
        }

        .header h1 {
            color: #525357;
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card p {
            font-size: 2rem;
            font-weight: 600;
            color: #2c2c2c;
        }

        .form-section {
            background: #fafafa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-field label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .time-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .time-input {
            padding: 12px 16px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: white;
            width: 80px;
            text-align: center;
        }

        .time-input:focus {
            outline: none;
            border-color: #6c757d;
            box-shadow: 0 0 0 2px rgba(108, 117, 125, 0.1);
        }

        .ampm-select {
            padding: 12px 8px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: white;
            width: 70px;
        }

        .ampm-select:focus {
            outline: none;
            border-color: #6c757d;
            box-shadow: 0 0 0 2px rgba(108, 117, 125, 0.1);
        }

        .form-field input, .form-field select {
            padding: 12px 16px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: white;
        }

        .form-field input:focus, .form-field select:focus {
            outline: none;
            border-color: #6c757d;
            box-shadow: 0 0 0 2px rgba(108, 117, 125, 0.1);
        }

        .btn {
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #2c2c2c;
            color: white;
        }

        .btn-primary:hover {
            background: #1a1a1a;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-export {
            background: white;
            color: #2c2c2c;
            border: 1px solid #2c2c2c;
            margin-left: 10px;
        }

        .btn-export:hover {
            background: #2c2c2c;
            color: white;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .section-header h3 {
            font-size: 1.2rem;
            font-weight: 500;
            color: #2c2c2c;
        }

        .shifts-container {
            background: white;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .shifts-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .batch-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .shift-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f3f4;
            display: grid;
            grid-template-columns: 40px 1fr auto auto auto;
            gap: 15px;
            align-items: center;
            transition: background 0.2s ease;
        }

        .shift-item:hover {
            background: #fafafa;
        }

        .shift-item:last-child {
            border-bottom: none;
        }

        .shift-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .shift-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .shift-date {
            font-weight: 500;
            color: #2c2c2c;
            font-size: 1rem;
        }

        .shift-time {
            color: #6c757d;
            font-size: 0.85rem;
        }

        .shift-hours {
            background: #2c2c2c;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 500;
            text-align: center;
            min-width: 60px;
            font-size: 0.9rem;
        }

        .payment-section {
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .payment-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f3f4;
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 15px;
            align-items: center;
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .payment-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .payment-period {
            font-weight: 500;
            color: #2c2c2c;
        }

        .payment-details {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .payment-amount {
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 500;
            text-align: center;
            min-width: 80px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state div {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .shift-item {
                grid-template-columns: 1fr;
                text-align: left;
                gap: 10px;
            }
            
            .form-group {
                grid-template-columns: 1fr;
            }
            
            .shifts-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .batch-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Shift Manager</h1>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Hours</h3>
                <p id="totalHours">0.0h</p>
            </div>
            <div class="stat-card">
                <h3>Unpaid Hours</h3>
                <p id="unpaidHours">0.0h</p>
            </div>
            <div class="stat-card">
                <h3>Total Earned</h3>
                <p id="totalEarned">$0.00</p>
            </div>
        </div>

        <div class="form-section">
            <div class="form-group">
                <div class="form-field">
                    <label for="shiftDate">Date</label>
                    <input type="date" id="shiftDate" required>
                </div>
                <div class="form-field">
                    <label for="startTime">Start Time</label>
                    <div class="time-input-group">
                        <input type="text" class="time-input" id="startTimeHour" placeholder="12" maxlength="2" oninput="validateTimeInput(this, 12)">
                        <span>:</span>
                        <input type="text" class="time-input" id="startTimeMinute" placeholder="00" maxlength="2" oninput="validateTimeInput(this, 59)">
                        <select class="ampm-select" id="startTimeAmPm">
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>
                </div>
                <div class="form-field">
                    <label for="endTime">End Time</label>
                    <div class="time-input-group">
                        <input type="text" class="time-input" id="endTimeHour" placeholder="12" maxlength="2" oninput="validateTimeInput(this, 12)">
                        <span>:</span>
                        <input type="text" class="time-input" id="endTimeMinute" placeholder="00" maxlength="2" oninput="validateTimeInput(this, 59)">
                        <select class="ampm-select" id="endTimeAmPm">
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="addShift()">Add Shift</button>
        </div>

        <div class="shifts-container">
            <div class="shifts-header">
                <div class="section-header">
                    <h3>Unpaid Shifts</h3>
                </div>
                <div class="batch-controls">
                    <input type="date" id="paymentDate" placeholder="Payment date">
                    <input type="number" id="paymentAmount" placeholder="Amount paid" step="0.01" style="width: 120px;">
                    <button class="btn btn-secondary" onclick="processPayment()">Process Payment</button>
                    <button class="btn btn-export" onclick="exportData()">Export Data</button>
                </div>
            </div>
            <div id="shiftsList">
                <div class="empty-state">
                    <div>📋</div>
                    <p>No shifts added yet. Add your first shift above!</p>
                </div>
            </div>
        </div>

        <div id="paymentsSection" style="display: none;">
            <div class="payment-section">
                <div class="payment-header">
                    <h3>Payment History</h3>
                    <button class="btn btn-export" onclick="exportPayments()">Export Payments</button>
                </div>
                <div id="paymentsList"></div>
            </div>
        </div>
    </div>

    <script>
        let shifts = [];
        let payments = [];
        let selectedShifts = [];

        // Local Storage Functions
        function saveToLocalStorage() {
            try {
                localStorage.setItem('shiftManager_shifts', JSON.stringify(shifts));
                localStorage.setItem('shiftManager_payments', JSON.stringify(payments));
            } catch (error) {
                console.error('Failed to save data to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedShifts = localStorage.getItem('shiftManager_shifts');
                const savedPayments = localStorage.getItem('shiftManager_payments');
                
                if (savedShifts) {
                    shifts = JSON.parse(savedShifts);
                }
                
                if (savedPayments) {
                    payments = JSON.parse(savedPayments);
                }
            } catch (error) {
                console.error('Failed to load data from localStorage:', error);
                // Keep default empty arrays if loading fails
                shifts = [];
                payments = [];
            }
        }

        // Load data when page starts
        loadFromLocalStorage();

        // Set today's date as default
        document.getElementById('shiftDate').valueAsDate = new Date();

        function calculateHours(startTime, endTime) {
            const start = new Date(`2000-01-01 ${startTime}`);
            let end = new Date(`2000-01-01 ${endTime}`);
            
            if (end < start) {
                end.setDate(end.getDate() + 1);
            }
            
            const diffMs = end - start;
            return diffMs / (1000 * 60 * 60);
        }

        function formatTime12Hour(hour, minute, ampm) {
            return `${hour}:${minute.padStart(2, '0')} ${ampm}`;
        }

        function convertTo24Hour(hour, minute, ampm) {
            let hour24 = parseInt(hour);
            if (ampm === 'AM' && hour24 === 12) hour24 = 0;
            if (ampm === 'PM' && hour24 !== 12) hour24 += 12;
            return `${hour24.toString().padStart(2, '0')}:${minute.padStart(2, '0')}`;
        }

        function convertFrom24Hour(time24) {
            const [hour, minute] = time24.split(':');
            let hour12 = parseInt(hour);
            const ampm = hour12 >= 12 ? 'PM' : 'AM';
            if (hour12 === 0) hour12 = 12;
            if (hour12 > 12) hour12 -= 12;
            return { hour: hour12.toString(), minute, ampm };
        }

        function validateTimeInput(input, max) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 2) value = value.substring(0, 2);
            if (parseInt(value) > max) value = max.toString();
            if (value.length === 1 && parseInt(value) > Math.floor(max/10) && max < 60) {
                value = '0' + value;
            }
            input.value = value;
        }

        function formatTime(time) {
            return new Date(`2000-01-01 ${time}`).toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        function formatDate(dateStr) {
            return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function addShift() {
            const date = document.getElementById('shiftDate').value;
            const startHour = document.getElementById('startTimeHour').value;
            const startMinute = document.getElementById('startTimeMinute').value || '00';
            const startAmPm = document.getElementById('startTimeAmPm').value;
            const endHour = document.getElementById('endTimeHour').value;
            const endMinute = document.getElementById('endTimeMinute').value || '00';
            const endAmPm = document.getElementById('endTimeAmPm').value;

            if (!date || !startHour || !endHour) {
                alert('Please fill in all required fields');
                return;
            }

            if (parseInt(startHour) < 1 || parseInt(startHour) > 12 || 
                parseInt(endHour) < 1 || parseInt(endHour) > 12) {
                alert('Hours must be between 1 and 12');
                return;
            }

            const startTime = convertTo24Hour(startHour, startMinute, startAmPm);
            const endTime = convertTo24Hour(endHour, endMinute, endAmPm);
            const hours = calculateHours(startTime, endTime);
            
            const shift = {
                id: Date.now(),
                date: date,
                startTime: startTime,
                endTime: endTime,
                hours: hours,
                paid: false
            };

            shifts.push(shift);
            shifts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            saveToLocalStorage();
            renderShifts();
            updateStats();
            
            // Clear time inputs
            document.getElementById('startTimeHour').value = '';
            document.getElementById('startTimeMinute').value = '';
            document.getElementById('endTimeHour').value = '';
            document.getElementById('endTimeMinute').value = '';
        }

        function deleteShift(id) {
            shifts = shifts.filter(shift => shift.id !== id);
            selectedShifts = selectedShifts.filter(shiftId => shiftId !== id);
            saveToLocalStorage();
            renderShifts();
            updateStats();
        }

        function toggleShiftSelection(id) {
            const index = selectedShifts.indexOf(id);
            if (index > -1) {
                selectedShifts.splice(index, 1);
            } else {
                selectedShifts.push(id);
            }
        }

        function processPayment() {
            const paymentDate = document.getElementById('paymentDate').value;
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);

            if (!paymentDate || !paymentAmount || selectedShifts.length === 0) {
                alert('Please select shifts, enter payment date and amount');
                return;
            }

            const selectedShiftObjects = shifts.filter(shift => selectedShifts.includes(shift.id));
            const totalHours = selectedShiftObjects.reduce((sum, shift) => sum + shift.hours, 0);

            const payment = {
                id: Date.now(),
                date: paymentDate,
                amount: paymentAmount,
                hours: totalHours,
                shifts: selectedShiftObjects.map(s => ({...s}))
            };

            payments.push(payment);
            payments.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Mark shifts as paid
            shifts = shifts.filter(shift => !selectedShifts.includes(shift.id));
            selectedShifts = [];

            document.getElementById('paymentDate').value = '';
            document.getElementById('paymentAmount').value = '';

            saveToLocalStorage();
            renderShifts();
            renderPayments();
            updateStats();
        }

        function deletePayment(id) {
            const payment = payments.find(p => p.id === id);
            if (payment) {
                // Add shifts back to unpaid list
                payment.shifts.forEach(shift => {
                    shift.paid = false;
                    shifts.push(shift);
                });
                shifts.sort((a, b) => new Date(b.date) - new Date(a.date));
            }
            
            payments = payments.filter(p => p.id !== id);
            saveToLocalStorage();
            renderShifts();
            renderPayments();
            updateStats();
        }

        function renderShifts() {
            const shiftsList = document.getElementById('shiftsList');
            const unpaidShifts = shifts.filter(shift => !shift.paid);
            
            if (unpaidShifts.length === 0) {
                shiftsList.innerHTML = `
                    <div class="empty-state">
                        <div>📋</div>
                        <p>No unpaid shifts. All caught up!</p>
                    </div>
                `;
                return;
            }

            shiftsList.innerHTML = unpaidShifts.map(shift => `
                <div class="shift-item">
                    <input type="checkbox" class="shift-checkbox" ${selectedShifts.includes(shift.id) ? 'checked' : ''} 
                           onchange="toggleShiftSelection(${shift.id})">
                    <div class="shift-info">
                        <div class="shift-date">${formatDate(shift.date)}</div>
                        <div class="shift-time">${formatTime(shift.startTime)} - ${formatTime(shift.endTime)}</div>
                    </div>
                    <div class="shift-hours">${shift.hours.toFixed(1)}h</div>
                    <button class="btn btn-danger" onclick="deleteShift(${shift.id})">Delete</button>
                </div>
            `).join('');
        }

        function renderPayments() {
            const paymentsSection = document.getElementById('paymentsSection');
            const paymentsList = document.getElementById('paymentsList');
            
            if (payments.length === 0) {
                paymentsSection.style.display = 'none';
                return;
            }

            paymentsSection.style.display = 'block';
            
            paymentsList.innerHTML = payments.map(payment => `
                <div class="payment-item">
                    <div class="payment-info">
                        <div class="payment-period">Payment - ${formatDate(payment.date)}</div>
                        <div class="payment-details">${payment.hours.toFixed(1)} hours • ${payment.shifts.length} shifts</div>
                    </div>
                    <div class="payment-amount">$${payment.amount.toFixed(2)}</div>
                    <button class="btn btn-danger" onclick="deletePayment(${payment.id})">Undo</button>
                </div>
            `).join('');
        }

        function updateStats() {
            const totalHours = shifts.reduce((sum, shift) => sum + shift.hours, 0) + 
                              payments.reduce((sum, payment) => sum + payment.hours, 0);
            const unpaidHours = shifts.filter(shift => !shift.paid).reduce((sum, shift) => sum + shift.hours, 0);
            const totalEarned = payments.reduce((sum, payment) => sum + payment.amount, 0);

            document.getElementById('totalHours').textContent = totalHours.toFixed(1) + 'h';
            document.getElementById('unpaidHours').textContent = unpaidHours.toFixed(1) + 'h';
            document.getElementById('totalEarned').textContent = '$' + totalEarned.toFixed(2);
        }

        function exportData() {
            const data = {
                shifts: shifts,
                payments: payments,
                exported: new Date().toISOString()
            };
            
            const text = `SHIFT MANAGER DATA EXPORT
Generated: ${new Date().toLocaleDateString()}

=== UNPAID SHIFTS ===
${shifts.filter(s => !s.paid).map(shift => 
    `${formatDate(shift.date)} | ${formatTime(shift.startTime)} - ${formatTime(shift.endTime)} | ${shift.hours.toFixed(1)}h`
).join('\n')}

=== PAYMENT HISTORY ===
${payments.map(payment =>
    `${formatDate(payment.date)} | $${payment.amount.toFixed(2)} | ${payment.hours.toFixed(1)}h | ${payment.shifts.length} shifts`
).join('\n')}

=== SUMMARY ===
Total Hours Worked: ${(shifts.reduce((sum, shift) => sum + shift.hours, 0) + payments.reduce((sum, payment) => sum + payment.hours, 0)).toFixed(1)}h
Unpaid Hours: ${shifts.filter(shift => !shift.paid).reduce((sum, shift) => sum + shift.hours, 0).toFixed(1)}h
Total Earned: $${payments.reduce((sum, payment) => sum + payment.amount, 0).toFixed(2)}
`;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `shift-data-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportPayments() {
            const text = `PAYMENT HISTORY EXPORT
Generated: ${new Date().toLocaleDateString()}

${payments.map(payment => {
    const shiftsText = payment.shifts.map(shift => 
        `  ${formatDate(shift.date)} | ${formatTime(shift.startTime)} - ${formatTime(shift.endTime)} | ${shift.hours.toFixed(1)}h`
    ).join('\n');
    
    return `Payment Date: ${formatDate(payment.date)}
Amount: $${payment.amount.toFixed(2)}
Total Hours: ${payment.hours.toFixed(1)}h
Shifts Included:
${shiftsText}

---`;
}).join('\n')}

Total Payments: $${payments.reduce((sum, payment) => sum + payment.amount, 0).toFixed(2)}
Total Hours Paid: ${payments.reduce((sum, payment) => sum + payment.hours, 0).toFixed(1)}h
`;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `payment-history-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        renderShifts();
        renderPayments();
        updateStats();
    </script>
</body>
</html>